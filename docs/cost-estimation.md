# Claude API 비용 추정 가이드

이 문서는 appium-mcp를 사용할 때 발생하는 Claude API 비용을 추정하는 가이드입니다.

## 이미지 토큰 계산 방식

Claude는 이미지를 **512x512 타일**로 분할하고, 각 타일당 약 **768 토큰**을 사용합니다.

### 이미지 리사이즈 최적화 효과

| 기기 예시 | 원본 크기 | 최적화 후 | 타일 수 | 토큰 |
|----------|----------|----------|---------|------|
| Android 420dpi | 1080 x 2400 | 411 x 914 | 2 | ~1,536 |
| iPhone 15 Pro | 1179 x 2556 | 393 x 852 | 2 | ~1,536 |

**최적화 전**: ~11,520 토큰/이미지
**최적화 후**: ~1,536 토큰/이미지
**절감율**: 약 87% (7.5배 감소)

## Claude API 가격 (2024년 기준)

| 모델 | Input (1M 토큰) | Output (1M 토큰) |
|------|----------------|------------------|
| Claude 3.5 Sonnet | $3 | $15 |
| Claude 3 Haiku | $0.25 | $1.25 |

## 호출당 토큰 사용량

| 항목 | 토큰 수 |
|------|---------|
| 시스템 프롬프트 | ~500 |
| 스크린샷 (최적화 후) | ~1,536 |
| 요소 목록 (list_elements) | ~1,000 |
| AI 응답 | ~300 |
| **총 Input** | **~3,000** |
| **총 Output** | **~300** |

## 시나리오별 예상 비용

### Claude 3.5 Sonnet 기준

#### 1. 간단한 앱 테스트 (20회 호출)
```
Input:  20 × 3,000 = 60,000 토큰 → $0.18
Output: 20 × 300 = 6,000 토큰   → $0.09
────────────────────────────────────
총 비용: ~$0.27 (약 400원)
```

#### 2. E2E 테스트 시나리오 (50회 호출)
```
Input:  50 × 3,000 = 150,000 토큰 → $0.45
Output: 50 × 300 = 15,000 토큰    → $0.23
────────────────────────────────────
총 비용: ~$0.68 (약 1,000원)
```

#### 3. 복잡한 자동화 (200회 호출)
```
Input:  200 × 3,000 = 600,000 토큰 → $1.80
Output: 200 × 300 = 60,000 토큰    → $0.90
────────────────────────────────────
총 비용: ~$2.70 (약 4,000원)
```

### Claude 3 Haiku 기준 (저비용)

간단한 UI 탐색에는 Haiku도 충분할 수 있습니다:

```
E2E 테스트 (50회):
Input:  $0.04
Output: $0.02
─────────────
총 비용: ~$0.06 (약 90원)
```

## 최적화 전후 비용 비교

| 시나리오 | 최적화 전 | 최적화 후 | 절감율 |
|----------|----------|----------|--------|
| 간단한 테스트 (20회) | ~$2.00 | ~$0.27 | 87% |
| E2E 테스트 (50회) | ~$5.00 | ~$0.68 | 87% |
| 복잡한 자동화 (200회) | ~$20.00 | ~$2.70 | 87% |

## 비용 절감 팁

1. **list_elements 우선 사용**: 스크린샷 없이 요소 목록만으로 충분한 경우 이미지 토큰 절약
2. **Haiku 활용**: 단순 UI 탐색은 저렴한 Haiku 모델 사용 고려
3. **캐싱 활용**: 동일한 화면 반복 분석 시 결과 캐싱
4. **배치 처리**: 여러 작업을 하나의 호출로 묶어서 시스템 프롬프트 토큰 절약

## 기술적 구현

### Android 좌표 시스템
- density 기반 scale 계산: `scale = density / 160`
- 예: 420dpi → scale = 2.625
- 스크린샷: 픽셀 크기 / scale = 논리적 크기로 리사이즈
- 요소 좌표: 픽셀 / scale = 논리적 좌표로 변환
- tap/swipe: 논리적 좌표 × scale = 픽셀 좌표로 변환

### iOS 좌표 시스템
- WDA가 point(논리적) 단위 사용
- 스크린샷: 픽셀 크기 / scale = point 크기로 리사이즈
- 요소 좌표: point 단위로 직접 반환
- tap/swipe: point 좌표 그대로 사용
